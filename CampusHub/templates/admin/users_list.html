{% extends "layout.html" %}

{% block title %}User Management - CampusHub{% endblock %}

{% block content %}
<div class="container" style="max-width: 1200px;">
    <div class="events-header">
        <h2>User Management</h2>
        <a href="{{ url_for('user.dashboard') }}" class="btn btn-secondary" style="width: auto;">Back to Dashboard</a>
    </div>

    {% if users %}
    <div class="dashboard-card" style="padding: 0; overflow-x: auto;">
        <table style="width: 100%; border-collapse: collapse;">
            <thead>
                <tr style="background-color: #f8f9fa; border-bottom: 2px solid #dee2e6;">
                    <th style="padding: 1rem; text-align: left;">Email</th>
                    <th style="padding: 1rem; text-align: left;">Role</th>
                    <th style="padding: 1rem; text-align: center;">Status</th>
                    <th style="padding: 1rem; text-align: center;">Actions</th>
                </tr>
            </thead>
            <tbody>
                {% for user in users %}
                <tr style="border-bottom: 1px solid #dee2e6;">
                    <td style="padding: 1rem;">
                        {{ user.email }}
                        {% if user.id == current_user.id %}
                        <span style="color: #4a90e2; font-size: 0.8rem;">(You)</span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem;">
                        {% if user.role == 'admin' %}
                        <span
                            style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem; font-weight: 500; background-color: #e74c3c; color: white;">
                            {{ user.role.capitalize() }}
                        </span>
                        {% elif user.role == 'teacher' or user.role == 'instructor' %}
                        <span
                            style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem; font-weight: 500; background-color: #3498db; color: white;">
                            {{ user.role.capitalize() }}
                        </span>
                        {% else %}
                        <span
                            style="display: inline-block; padding: 0.25rem 0.75rem; border-radius: 4px; font-size: 0.85rem; font-weight: 500; background-color: #95a5a6; color: white;">
                            {{ user.role.capitalize() }}
                        </span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        {% if user.is_active %}
                        <span style="color: #27ae60; font-weight: 500;">● Active</span>
                        {% else %}
                        <span style="color: #e74c3c; font-weight: 500;">● Inactive</span>
                        {% endif %}
                    </td>
                    <td style="padding: 1rem; text-align: center;">
                        <div style="display: flex; gap: 0.5rem; justify-content: center;">
                            {% if user.id != current_user.id %}
                            <form action="{{ url_for('admin.toggle_active', user_id=user.id) }}" method="POST"
                                style="margin: 0;">
                                {% if user.is_active %}
                                <button type="submit" class="btn"
                                    style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background-color: #f39c12;">
                                    Deactivate
                                </button>
                                {% else %}
                                <button type="submit" class="btn"
                                    style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background-color: #27ae60;">
                                    Activate
                                </button>
                                {% endif %}
                            </form>
                            <form action="{{ url_for('admin.delete_user', user_id=user.id) }}" method="POST"
                                style="margin: 0;"
                                onsubmit="return confirm('Are you sure you want to delete {{ user.email }}? This action cannot be undone.');">
                                <button type="submit" class="btn"
                                    style="width: auto; padding: 0.5rem 1rem; font-size: 0.85rem; background-color: #e74c3c;">
                                    Delete
                                </button>
                            </form>
                            {% else %}
                            <span style="color: #95a5a6; font-size: 0.85rem;">No actions</span>
                            {% endif %}
                        </div>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <div
        style="margin-top: 1rem; padding: 1rem; background: #e8f4f8; border-radius: 8px; border-left: 4px solid #3498db;">
        <p style="margin: 0; font-size: 0.9rem; color: #2c3e50;">
            <strong>Total Users:</strong> {{ users|length }} |
            <strong>Active:</strong> {{ users|selectattr('is_active')|list|length }} |
            <strong>Inactive:</strong> {{ users|rejectattr('is_active')|list|length }}
        </p>
    </div>
    {% else %}
    <div class="dashboard-card">
        <p>No users found in the system.</p>
    </div>
    {% endif %}
</div>
{% endblock %}